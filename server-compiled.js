(()=>{var e={645:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});const a=require("axios");var n=o.n(a),r=o(689),s=o.n(r);const i=function(e){const[t,o]=(0,r.useState)(!1),[a,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(),[d,u]=(0,r.useState)("");return s().createElement("div",{className:"card"},s().createElement("div",{className:"our-card-top"},t&&s().createElement("div",{className:"our-custom-input"},s().createElement("div",{className:"our-custom-input-interior"},s().createElement("input",{onChange:e=>c(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),s().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`${e.author} named ${e.name}`})),s().createElement("div",{className:"card-body"},!t&&s().createElement(s().Fragment,null,s().createElement("h4",null,e.name),s().createElement("p",{className:"text-muted small"},e.author),!e.readOnly&&s().createElement(s().Fragment,null,s().createElement("button",{onClick:()=>{o(!0),i(e.name),u(e.author),c("")},className:"btn btn-sm btn-primary"},"Edit")," ",s().createElement("button",{onClick:async()=>{n().delete(`/book/${e.id}`),e.setBooks((t=>t.filter((t=>t._id!=e.id))))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&s().createElement("form",{onSubmit:async function(t){t.preventDefault(),o(!1),e.setBooks((t=>t.map((function(t){return t._id==e.id?{...t,name:a,author:d}:t}))));const r=new FormData;l&&r.append("photo",l),r.append("_id",e.id),r.append("name",a),r.append("author",d);const s=await n().post("/update-book",r,{headers:{"Content-Type":"multipart/form-data"}});s.data&&e.setBooks((t=>t.map((function(t){return t._id==e.id?{...t,photo:s.data}:t}))))}},s().createElement("div",{className:"mb-1"},s().createElement("input",{autoFocus:!0,onChange:e=>i(e.target.value),type:"text",className:"form-control form-control-sm",value:a})),s().createElement("div",{className:"mb-2"},s().createElement("input",{onChange:e=>u(e.target.value),type:"text",className:"form-control form-control-sm",value:d})),s().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",s().createElement("button",{onClick:()=>o(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const{MongoClient:e,ObjectId:t}=o(13),a=o(860),n=o(738)(),r=o(109),s=o(470),i=o(441);let l;const c=o(17),d=o(689),u=o(684),m=o(645).Z;s.ensureDirSync(c.join("public","uploaded-photos"));const p=a();function b(e,t,o){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.author&&(e.body.author=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:r(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),author:r(e.body.author.trim(),{allowedTags:[],allowedAttributes:{}})},o()}p.set("view engine","ejs"),p.set("views","./views"),p.use(a.static("public")),p.use(a.json()),p.use(a.urlencoded({extended:!1})),p.get("/",(async(e,t)=>{const o=await l.collection("books").find().toArray(),a=u.renderToString(d.createElement("div",{className:"container"},!o.length&&d.createElement("p",null,"no books yet, add now."),d.createElement("div",{className:"book-grid mb-3"},o.map((e=>d.createElement(m,{key:e._id,name:e.name,author:e.author,photo:e.photo,id:e._id,readOnly:!0})))),d.createElement("p",null,d.createElement("a",{href:"/admin"},"Login / manage the books."))));t.render("home",{generatedHTML:a})})),p.get("/admin",(function(e,t,o){t.set("WWW-Authenticate","Basic realm='MERN App'"),"Basic dXNlcjp1c2Vy"==e.headers.authorization?o():(console.log(e.headers.authorization),t.status(401).send(" wrong password, Try again"))}),((e,t)=>{t.render("admin")})),p.get("/api/books",(async(e,t)=>{const o=await l.collection("books").find().toArray();t.json(o)})),p.post("/create-book",n.single("photo"),b,(async(e,o)=>{if(e.file){const t=`${Date.now()}.jpg`;await i(e.file.buffer).resize(20,20).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const a=await l.collection("books").insertOne(e.cleanData),n=await l.collection("books").findOne({_id:new t(a.insertedId)});o.send(n)})),p.delete("/book/:id",(async(e,o)=>{"string"!=typeof e.params.id&&(e.params.id="");const a=await l.collection("books").findOne({_id:new t(e.params.id)});a.photo&&s.remove(c.join("public","uploaded-photos",a.photo)),l.collection("books").deleteOne({_id:new t(e.params.id)}),o.send("done")})),p.post("/update-book",n.single("photo"),b,(async(e,o)=>{if(e.file){const a=`${Date.now()}.jpg`;await i(e.file.buffer).resize({fit:i.fit.contain,width:800}).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",a)),e.cleanData.photo=a;const n=await l.collection("books").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData});n.value.photo&&s.remove(c.join("public","uploaded-photos",n.value.photo)),o.send(a)}else db.collection("books").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData}),o.send(!1)})),async function(){const t=new e("mongodb+srv://root:root@cluster0.e6m3qhx.mongodb.net/?retryWrites=true&w=majority");await t.connect(),l=t.db("MernApp"),p.listen(3e3)}()})()})();